# HTTP 请求和响应

## HTTP 请求报文

HTTP请求报文主要由**请求行、请求头部、请求正文**3部分组成：

（请求示例）

### 请求行

请求行由==请求方法==、==URL==、==协议版本==三部分构成，之间用空格隔开。

- 请求方法：POST、GET、HEAD、PUT、POST、TRACE、OPTIONS、DELETE 等；
- 协议版本：==HTTP/主版本号.次版本号==，常用的有 HTTP/1.0 和 HTTP/1.1。

### 请求头

请求头部为请求报文添加了一些附加信息，由“名/值”对组成，每行一对，名和值之间使用冒号分隔。

常见请求头如下：

- Host：接受请求的服务器地址，可以是==IP:端口号==，也可以是==域名==；
- User-Agent：发送请求的应用程序名称；
- Connection：指定与连接相关的属性，如 `Connection:Keep-Alive`；
- Accept-Charset：通知服务端可以发送的编码格式；
- Accept-Encoding：通知服务端可以发送的数据压缩格式；
- Accept-Language：通知服务端可以发送的语言。

### 请求正文

可选部分，比如 GET 请求就没有请求正文。

## HTTP 响应报文

HTTP 响应报文主要由**状态行、响应头部、响应正文**3部分组成：

（响应示例）

### 状态行

由3部分组成，分别为：协议版本、状态码、状态码描述，之间由空格分隔。

- 状态码：为3位数字
  - 200-299：表示成功；
  - 300-399：资源重定向；
  - 400-499：客户端请求出错；
  - 500-599：服务端出错；
  - 100-199：HTTP/1.1向协议中引入的信息性状态码
    
    

200：响应成功
302：重定向跳转，跳转地址通过响应头中的Location属性指定
400：客户端请求有语法错误，参数错误，不能被服务器识别
403：服务器接收到请求，但是拒绝提供服务（认证失败）
404：请求资源不存在
500：服务器内部错误

### 响应头部

与请求头部类似，为响应报文添加了一些附加信息：

- Server：服务器应用程序软件的名称和版本；
- Content-Type：响应正文的类型（是图片还是二进制字符串）；
- Content-Length：响应正文长度；
- Content-Charset：响应正文使用的编码；
- Content-Encoding：响应正文使用的数据压缩格式；
- Content-Language：响应正文使用的语言。

### 响应正文

是请求响应的最终结果，都在响应体里。

报文可以承载很多类型的数字数据：图片、视频、HTML文档、软件应用程序等。

## HTTP 请求和响应步骤[^2]

HTTP 请求的整个步骤：

在一次完整的 HTTP 通信过程中，Web 浏览器与 Web 服务器之间将完成7个步骤。

### 1. 建立 TCP 连接

在 HTTP 工作开始之前，Web 浏览器首先要通过网络与 Web 服务器建立连接。该连接是通过 TCP 来完成的，该协议与 IP 协议共同构建 Internet，即著名的 TCP/IP 协议族，因此 Internet 又被称作是 TCP/IP 网络。

HTTP 是比 TCP 更高层次的应用层协议，根据规则，只有低层协议建立之后才能进行更高层协议的连接。因此，首先要建立 TCP 连接，一般 TCP 连接的端口号是 80。

TCP 连接中存在三次握手的概念，但是为什么是三次而不是两次或四次呢？

> A 与 B 通过电报机交流，但由于电报机质量不稳定，有可能会出现失灵的情况，所以就出现了如下对话：
>
> A：B，你能收到我发的电报吗？你要是能收到，就说明我这个电报机可以发电报。
>
> B：A，我收到你发的话了，这说明我的电报机可以收。但是我不确定我的电报机能不能发，你能收到我发的电报吗？你要是能收到，就说明我的电报机是可以发电报的。（==证明 B 能收；A 能发==）
>
> A：B，我收到你的话了，我的电报机也是能发能收，我们可以正式交流了。（==证明 A 能收；B 能发==）

==三次握手确定了 client 和 server 的**发送和接收**功能都正常==。

如果只发送两次，那么不能确定 client 和 server 都能正常收发；如果发送四次或者更多，理论上当然也是可以的，但是网络环境十分复杂，任何两次请求间都可能出现错误，多出的请求次数并无法确保下一个请求一定安全。

### 2. 浏览器向服务器发送请求命令

一旦建立了 TCP 连接，Web 浏览器就会向 Web 服务器发送请求命令。

例如：GET/sample/hello.jsp HTTP/1.1

### 3. 浏览器发送请求头信息

浏览器发送其请求命令之后，还要以==头信息==的形式向 Web 服务器发送一些别的信息，这些信息用来==描述浏览器自己==。

之后浏览器发送了一空白行来通知服务器，表示它已经结束了该头信息的发送。若是 post 请求，还会在发送完请求头信息之后发送==请求体==。

### 4. 服务器应答

客户机向服务器发出请求后，服务器会向客户机回送应答：

```
HTTP/1.1 200 OK
```

应答的第一部分是==协议的版本号==和==应答状态码==。

### 5. 服务器发送应答头信息

正如客户端会随同请求发送关于自身的信息一样，服务器也会随同应答向用户发送关于它自己的数据及被请求的文档。最后以一个空白行来表示头信息发送到此结束。

### 6. 服务器向浏览器发送数据

Web 服务器向浏览器发送头信息后，它就以 `Content-Type` 应答头信息所描述的格式发送用户所请求的实际数据。

### 7. 服务器关闭 TCP 连接

一般情况下，一旦 Web 服务器向浏览器发送了请求数据，它就要关闭 TCP 连接。如果浏览器或者服务器在其头信息加入了这行代码

```
Connection:keep-alive
```

TCP 连接在发送后将仍然保持打开状态。于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽。









# OkHttp 使用





# 参考资料

[OkHttp3简单使用教程(一)：请求和响应 - 简书 (jianshu.com)](https://www.jianshu.com/p/f3f228d3598c)

[^2]: [文加图, 理解Http请求与响应 - 简书 (jianshu.com)](https://www.jianshu.com/p/51a61845e66a#)

[OkHttp使用完全教程 - 简书 (jianshu.com)](https://www.jianshu.com/p/ca8a982a116b)

[OkHttp源码分析(一)请求和响应过程简单分析 - NullObject](https://www.nullobject.cn/archives/okhttp01.html)

[Okhttp 使用（同步、异步/get、post/上传文件） - 简书 (jianshu.com)](https://www.jianshu.com/p/dd9c7e7ac8ed)

[OkHttp使用进阶 译自OkHttp Github官方教程 - GavinCT - 博客园 (cnblogs.com)](https://www.cnblogs.com/ct2011/p/3997368.html)
